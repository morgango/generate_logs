# Elasticsearch Grok Patterns for Log Parsing

This document provides Grok patterns for parsing all log formats generated by this tool, conforming to Elastic Common Schema (ECS).

## Format Overview

| Format | Identifier | Grok Pattern | ECS Fields |
|--------|------------|--------------|------------|
| Apache | File path | Apache HTTP Access | `@timestamp`, `client.ip`, `http.request.method`, `http.response.status_code` |
| CSV | File path | Comma-delimited | `@timestamp`, `log.level`, `service.name` |
| PIPE | File path | Pipe-delimited + key=value | `@timestamp`, `log.level`, `service.name`, `transaction.id` |
| KV | File path | Key=value pairs | `@timestamp`, `log.level`, `service.name`, `http.request.id` |
| Hadoop | File path | Space-delimited system logs | `@timestamp`, `log.level`, `host.name`, `process.name` |
| Logstash | File path | Semi-colon delimited | `@timestamp`, `log.level`, `service.name`, `user.id` |
| NGINX | File path | HTTP Access (NGINX) | `@timestamp`, `client.ip`, `http.request.method`, `http.response.status_code` |
| Tomcat | File path | Java Application | `@timestamp`, `log.level`, `process.name`, `log.origin.thread` |
| MySQL | File path | Database Query | `@timestamp`, `user.name`, `database.name`, `db.query` |
| Redis | File path | Cache/Database | `@timestamp`, `log.level`, `process.pid`, `service.role` |
| Syslog | File path | Structured syslog with custom data | `@timestamp`, `log.level`, `host.name`, `process.name`, `http.request.id` |

## Grok Patterns

## Generic access
```
%{GREEDYDATA:attributes.custom.message}
```

### 1. Apache HTTP Access Logs
```
%{IPV4:attributes.client.ip}\s%{DATA:attributes.custom.ident}\s+%{DATA:attributes.custom.auth}\s\[%{INT:attributes.user.name}/(?<attributes.custom.timestamp>%{MONTH}/%{YEAR}:%{INT}:%{INT}:%{INT}) \]\s"%{WORD:attributes.http.request.method} %{NOTSPACE:attributes.url.path} %{DATA:attributes.http.version}"\s%{INT:attributes.http.response.status_code}\s%{INT:attributes.http.response.body.bytes}\s"-"\s"%{WORD:attributes.user_agent.name}/(?<attributes.user_agent.version>%{INT}\.%{INT})"\s(?<attributes.event.duration>%{INT}\.%{INT})\s%{GREEDYDATA:attributes.service.name}
```

**Direct ECS Field Extraction:**
- `@timestamp` ← `attributes.custom.timestamp`
- `client.ip` ← `attributes.client.ip`
- `http.request.method` ← `attributes.http.request.method`
- `http.request.uri.original` ← `attributes.url.path`
- `http.response.status_code` ← `attributes.http.response.status_code`
- `http.response.bytes` ← `attributes.http.response.body.bytes`
- `http.request.referrer` ← `attributes.http.request.referrer`
- `user_agent.original` ← `attributes.user_agent.original`
- `event.duration` ← `attributes.event.duration`
- `service.name` ← `attributes.service.name`
- `custom.ident` ← `attributes.custom.ident`
- `custom.auth` ← `attributes.custom.auth`

### 2. CSV Format
```
%{TIMESTAMP_ISO8601:attributes.custom.timestamp},%{LOGLEVEL:attributes.log.level},%{WORD:attributes.service.name},%{WORD:attributes.user.id},%{INT:attributes.event.duration},%{INT:attributes.http.response.status_code},%{GREEDYDATA:attributes.custom.message}
```

**Direct ECS Field Extraction:**
- `@timestamp` ← `attributes.custom.timestamp`
- `log.level` ← `attributes.log.level`
- `service.name` ← `attributes.service.name`
- `user.id` ← `attributes.user.id`
- `event.duration` ← `attributes.event.duration`
- `http.response.status_code` ← `attributes.http.response.status_code`
- `custom.message` ← `attributes.custom.message`
- `custom.type` ← `custom.type`

### 3. PIPE Format
```
%{TIMESTAMP_ISO8601:attributes.custom.timestamp}\|%{WORD:attributes.log.level}\|%{DATA:attributes.service.name}\|txn=%{DATA:attributes.transaction.id}\|amount=%{NUMBER:attributes.transaction.amount:float}\|country=%{WORD:attributes.client.geo.country_iso_code}\|session=%{GREEDYDATA:attributes.session.id}
```

**Direct ECS Field Extraction:**
- `@timestamp` ← `attributes.custom.timestamp`
- `log.level` ← `attributes.log.level`
- `service.name` ← `attributes.service.name`
- `transaction.id` ← `attributes.transaction.id`
- `transaction.amount` ← `attributes.transaction.amount`
- `client.geo.country_iso_code` ← `attributes.client.geo.country_iso_code`
- `session.id` ← `attributes.session.id`
- `custom.type` ← `custom.type`

### 4. KV Format
```
ts=%{TIMESTAMP_ISO8601:attributes.custom.timestamp} level=%{WORD:attributes.log.level} service=%{DATA:attributes.service.name} req=%{DATA:attributes.http.request.id} duration_ms=%{NUMBER:attributes.event.duration_ms:int} msg=%{GREEDYDATA:attributes.custom.message}
```

**Direct ECS Field Extraction:**
- `@timestamp` ← `attributes.custom.timestamp`
- `log.level` ← `attributes.log.level`
- `service.name` ← `attributes.service.name`
- `http.request.id` ← `attributes.http.request.id`
- `event.duration_ms` ← `attributes.event.duration_ms`
- `custom.message` ← `attributes.custom.message`
- `custom.type` ← `custom.type`

### 5. Hadoop Format
```
%{TIMESTAMP_ISO8601:attributes.custom.timestamp} %{WORD:attributes.log.level} %{WORD:attributes.process.name} %{IPORHOST:attributes.hadoop.host.name} %{NOTSPACE:attributes.hadoop.job.id} %{NOTSPACE:attributes.hadoop.task.id}\s+memory=%{NUMBER:attributes.hadoop.task.memory_mb:int}\s+cpu=%{NUMBER:attributes.hadoop.task.cpu_cores:int}\s+duration=%{NUMBER:attributes.event.duration_ms:int}\s%{GREEDYDATA:attributes.custom.message}
```


**Direct ECS Field Extraction:**
- `@timestamp` ← `attributes.custom.timestamp`
- `log.level` ← `attributes.log.level`
- `process.name` ← `attributes.process.name`
- `hadoop.host.name` ← `attributes.hadoop.host.name`
- `hadoop.job.id` ← `attributes.hadoop.job.id`
- `hadoop.task.id` ← `attributes.hadoop.task.id`
- `hadoop.task.memory_mb` ← `attributes.hadoop.task.memory_mb`
- `hadoop.task.cpu_cores` ← `attributes.hadoop.task.cpu_cores`
- `event.duration_ms` ← `attributes.event.duration_ms`
- `custom.message` ← `attributes.custom.message`
- `custom.type` ← `custom.type`

### 6. Logstash Format
```
@timestamp=%{TIMESTAMP_ISO8601:attributes.custom.timestamp};\s+level=%{WORD:attributes.log.level};\s+service=%{NOTSPACE:attributes.custom.service.name};\s+request_id=%{NOTSPACE:attributes.http.request.id};\s+session_id=%{NOTSPACE:attributes.session.id};\s+user_id=%{NOTSPACE:attributes.user.id};\s+duration_ms=%{NUMBER:attributes.event.duration_ms:int};\s+status_code=%{NUMBER:attributes.http.response.status_code:int};\s+ip=%{IP:attributes.client.ip};\s+user_agent=%{DATA:attributes.user_agent.original};\s+message=%{GREEDYDATA:attributes.custom.message}$
```


**Direct ECS Field Extraction:**
- `@timestamp` ← `attributes.custom.timestamp`
- `log.level` ← `attributes.log.level`
- `custom.service.name` ← `attributes.custom.service.name`
- `http.request.id` ← `attributes.http.request.id`
- `session.id` ← `attributes.session.id`
- `user.id` ← `attributes.user.id`
- `event.duration_ms` ← `attributes.event.duration_ms`
- `http.response.status_code` ← `attributes.http.response.status_code`
- `client.ip` ← `attributes.client.ip`
- `user_agent.original` ← `attributes.user_agent.original`
- `custom.message` ← `attributes.custom.message`
- `custom.type` ← `custom.type`

### 7. NGINX Format
```
%{IPV4:attributes.client.ip}\s+%{DATA:attributes.custom.ident}\s+%{DATA:attributes.custom.auth}\[(?<attributes.custom.timestamp>%{MONTHDAY}/%{MONTH}/%{YEAR}:%{TIME})(?: %{INT})?\s*\]\s+"%{WORD:attributes.http.request.method}\s+%{NOTSPACE:attributes.url.path}\s+%{DATA:attributes.http.version}"\s+%{INT:attributes.http.response.status_code}\s%{INT:attributes.http.response.body.bytes}\s+"%{DATA:attributes.http.request.referrer}"\s+"%{DATA:attributes.user_agent.original}"\s+rt=%{NUMBER:attributes.event.duration:float}\s+upstream=%{GREEDYDATA:attributes.service.name}
```

**Direct ECS Field Extraction:**
- `@timestamp` ← `attributes.custom.timestamp`
- `client.ip` ← `attributes.client.ip`
- `http.request.method` ← `attributes.http.request.method`
- `http.request.uri.original` ← `attributes.url.path`
- `http.response.status_code` ← `attributes.http.response.status_code`
- `http.response.bytes` ← `attributes.http.response.body.bytes`
- `http.request.referrer` ← `attributes.http.request.referrer`
- `user_agent.original` ← `attributes.user_agent.original`
- `event.duration` ← `attributes.event.duration`
- `service.name` ← `attributes.service.name`
- `custom.ident` ← `attributes.custom.ident`
- `custom.auth` ← `attributes.custom.auth`
- `custom.type` ← `custom.type`

### 8. Tomcat Format
```
%{TIMESTAMP_ISO8601:attributes.custom.timestamp}\s+%{WORD:attributes.log.level}\s+%{NOTSPACE:attributes.process.name}\s+%{NOTSPACE:attributes.log.origin.thread}\s+%{GREEDYDATA:attributes.custom.message}
```

**Direct ECS Field Extraction:**
- `@timestamp` ← `attributes.custom.timestamp`
- `log.level` ← `attributes.log.level`
- `process.name` ← `attributes.process.name`
- `log.origin.thread` ← `attributes.log.origin.thread`
- `custom.message` ← `attributes.custom.message`
- `custom.type` ← `custom.type`

### 9. MySQL Format
```
%{TIMESTAMP_ISO8601:attributes.custom.timestamp} %{DATA:attributes.user.name}\[%{DATA:attributes.user.name}\] @ %{IPORHOST:attributes.host.ip} \[%{TIMESTAMP_ISO8601:attributes.query.timestamp}\] %{NUMBER:attributes.event.duration:float} %{NUMBER:attributes.lock_time:float} %{NUMBER:attributes.db.rows_sent:int} %{NUMBER:attributes.db.rows_examined:int} %{DATA:attributes.db.name} %{GREEDYDATA:attributes.db.query}
```

**Direct ECS Field Extraction:**
- `@timestamp` ← `attributes.custom.timestamp`
- `user.name` ← `attributes.user.name`
- `host.ip` ← `attributes.host.ip`
- `query_timestamp` ← `attributes.query.timestamp`
- `event.duration` ← `attributes.event.duration`
- `lock_time` ← `attributes.lock_time`
- `db.rows_sent` ← `attributes.db.rows_sent`
- `db.rows_examined` ← `attributes.db.rows_examined`
- `db.name` ← `attributes.db.name`
- `db.query` ← `attributes.db.query`
- `custom.type` ← `custom.type`

### 10. Redis Format
```
%{TIMESTAMP_ISO8601:attributes.custom.timestamp} %{WORD:attributes.log.level} %{NUMBER:attributes.process.pid:int}:%{DATA:attributes.process_type} %{DATA:attributes.service.role} %{GREEDYDATA:attributes.custom.message}
```

**Direct ECS Field Extraction:**
- `@timestamp` ← `attributes.custom.timestamp`
- `log.level` ← `attributes.log.level`
- `process.pid` ← `attributes.process.pid`
- `process_type` ← `attributes.process_type`
- `service.role` ← `attributes.service.role`
- `custom.message` ← `attributes.custom.message`
- `custom.type` ← `custom.type`

### 11. Syslog Format (RFC 5424)
```
SYSLOG_RFC5424 <%{NUMBER:attributes.syslog.priority:int}>%{NUMBER:attributes.syslog.version:int} %{TIMESTAMP_ISO8601:attributes.custom.timestamp} %{IPORHOST:attributes.host.name} %{NOTSPACE:attributes.process.name} %{NUMBER:attributes.process.pid:int} - \[%{NOTSPACE:attributes.syslog.structured_data_id}@%{NUMBER:attributes.syslog.enterprise_id:int} service="%{DATA:attributes.service.name}" request_id="%{DATA:attributes.http.request.id}" session_id="%{DATA:attributes.session.id}" user_id="%{DATA:attributes.user.id}" duration_ms="%{NUMBER:attributes.event.duration_ms:int}" status_code="%{NUMBER:attributes.http.response.status_code:int}" client_ip="%{IP:attributes.client.ip}"\] %{GREEDYDATA:attributes.custom.message}
```

**Direct ECS Field Extraction:**
- `@timestamp` ← `attributes.custom.timestamp`
- `host.name` ← `attributes.host.name`
- `process.name` ← `attributes.process.name`
- `process.pid` ← `attributes.process.pid`
- `service.name` ← `attributes.service.name`
- `http.request.id` ← `attributes.http.request.id`
- `session.id` ← `attributes.session.id`
- `user.id` ← `attributes.user.id`
- `event.duration_ms` ← `attributes.event.duration_ms`
- `http.response.status_code` ← `attributes.http.response.status_code`
- `client.ip` ← `attributes.client.ip`
- `custom.message` ← `attributes.custom.message`
- `syslog.priority` ← `attributes.syslog.priority`
- `syslog.version` ← `attributes.syslog.version`
- `syslog.structured_data_id` ← `attributes.syslog.structured_data_id`
- `syslog.enterprise_id` ← `attributes.syslog.enterprise_id`

**Example Syslog Message:**
```
SYSLOG_RFC5424 <166>1 2023-12-25T10:30:45.123Z app-3.cluster.local loggen-checkout 12345 - [app@12345 service="checkout" request_id="req-a1b2c3d4" session_id="sess-e5f6g7h8i9j0" user_id="user-1234" duration_ms="250" status_code="200" client_ip="10.1.2.3"] User initiated checkout process
```

## Usage Notes

1. **Format Identification**: Each format is written to its own file (e.g., `loadgen_apache.log`, `loadgen_csv.log`, etc.)
2. **ECS Compliance**: All fields map to standard ECS field names
3. **Data Types**: Proper type casting for numbers, dates, and IPs
4. **Flexibility**: Patterns handle variations in log formats
5. **Performance**: Optimized for high-volume log processing
6. **Syslog Special**: The syslog format follows RFC 5424 standard with structured data for enhanced parsing
7. **File-based Filtering**: Use file path patterns to identify log formats in Elasticsearch/Kibana

## Testing Patterns

Use the Grok Debugger in Kibana or online tools to test these patterns with sample log data from your log generator.
